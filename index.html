<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>å‡ºè²¨è¨ˆç®—å°å·¥å…·</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Flatpickr CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');
        body {
            font-family: 'Noto Sans TC', system-ui, -apple-system, sans-serif;
            background: #f1f5f9;
        }
        .num::-webkit-outer-spin-button,
        .num::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .num {
            -moz-appearance: textfield;
        }
        .section-card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            padding: 1.5rem;
            border: 1px solid #e2e8f0;
        }
    </style>
</head>
<body class="min-h-screen py-8 px-4">
    <main class="w-full max-w-3xl mx-auto space-y-6">
        <h1 class="text-3xl font-black text-center text-slate-800 mb-8">ğŸ“¦ å‡ºè²¨è¨ˆç®—ç¶œåˆå·¥å…·</h1>

        <!-- ç®±æ•¸è¨ˆç®—å€å€å¡Š -->
        <section class="section-card">
            <div class="flex items-center justify-between mb-4 border-b pb-2">
                <h2 class="text-lg font-bold text-slate-700">ç®±æ•¸è¨ˆç®— (å¤§ç®±å„ªå…ˆ)</h2>
                <span class="text-xs text-indigo-500 font-bold bg-indigo-50 px-2 py-1 rounded">æœ€å„ªä½µç®±ç®—æ³•</span>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-3 mb-6">
                <label class="flex items-center justify-between text-sm font-medium text-slate-600">
                    é›™å±¤-çœŸæ„›æŒ‘æ—¥å­
                    <input id="item1" type="number" min="0" value="0" class="num w-20 text-center border rounded-lg px-2 py-1 focus:ring-2 focus:ring-indigo-500 outline-none">
                </label>
                <label class="flex items-center justify-between text-sm font-medium text-slate-600">
                    é›™å±¤-è‡ªè£½ç›’
                    <input id="item2" type="number" min="0" value="0" class="num w-20 text-center border rounded-lg px-2 py-1 focus:ring-2 focus:ring-indigo-500 outline-none">
                </label>
                <label class="flex items-center justify-between text-sm font-medium text-slate-600">
                    è¯éº—ä¼¯çˆµ
                    <input id="item3" type="number" min="0" value="0" class="num w-20 text-center border rounded-lg px-2 py-1 focus:ring-2 focus:ring-indigo-500 outline-none">
                </label>
                <label class="flex items-center justify-between text-sm font-medium text-slate-600">
                    å±±èŒ¶èŠ±é–‹æ™‚&HANA
                    <input id="item4" type="number" min="0" value="0" class="num w-20 text-center border rounded-lg px-2 py-1 focus:ring-2 focus:ring-indigo-500 outline-none">
                </label>
                <label class="flex items-center justify-between text-sm font-medium text-slate-600">
                    å’Œå…‰è“å®¤&ç¹”èŠ±
                    <input id="item5" type="number" min="0" value="0" class="num w-20 text-center border rounded-lg px-2 py-1 focus:ring-2 focus:ring-indigo-500 outline-none">
                </label>
                <label class="flex items-center justify-between text-sm font-medium text-slate-600">
                    å¾®ç¬‘ä¿±æ¨‚éƒ¨
                    <input id="item6" type="number" min="0" value="0" class="num w-20 text-center border rounded-lg px-2 py-1 focus:ring-2 focus:ring-indigo-500 outline-none">
                </label>
                <label class="flex items-center justify-between text-sm font-medium text-slate-600">
                    6å…¥æ˜Ÿç©ºå¤©åœ°è“‹ç›’
                    <input id="item7" type="number" min="0" value="0" class="num w-20 text-center border rounded-lg px-2 py-1 focus:ring-2 focus:ring-indigo-500 outline-none">
                </label>
                <label class="flex items-center justify-between text-sm font-medium text-slate-600">
                    èŠ±æ‰‹é 
                    <input id="item8" type="number" min="0" value="0" class="num w-20 text-center border rounded-lg px-2 py-1 focus:ring-2 focus:ring-indigo-500 outline-none">
                </label>
            </div>

            <div class="grid grid-cols-2 gap-3">
                <button id="calculateBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-xl shadow-lg shadow-indigo-100 transition-all active:scale-95">è¨ˆç®—ç®±æ•¸</button>
                <button id="resetBtn" class="bg-slate-200 hover:bg-slate-300 text-slate-600 font-bold py-3 rounded-xl transition-all active:scale-95">å…¨éƒ¨é‡ç½®</button>
            </div>

            <div id="results" class="mt-6 p-4 bg-indigo-50 rounded-xl border border-indigo-100">
                <h3 class="text-sm font-bold text-indigo-800 mb-2">è¨ˆç®—çµæœ</h3>
                <div id="resultText" class="text-indigo-900 space-y-1">
                    è«‹è¼¸å…¥æ•¸é‡ä¸¦é»æ“Šã€Œè¨ˆç®—ç®±æ•¸ã€ã€‚
                </div>
            </div>
        </section>

        <!-- æ•ˆæœŸè¨ˆç®—å€å¡Š -->
        <section class="section-card">
            <h2 class="text-lg font-bold text-slate-700 mb-4">æ•ˆæœŸè¨ˆç®—</h2>
            <div class="flex flex-col md:flex-row gap-3 mb-4">
                <input id="mfgDate" type="text" placeholder="é¸æ“‡æ—¥æœŸ" class="border rounded-xl px-4 py-2 flex-1 focus:ring-2 focus:ring-emerald-500 outline-none">
                <select id="storageType" class="border rounded-xl px-4 py-2 bg-white focus:ring-2 focus:ring-emerald-500 outline-none font-medium">
                    <option value="14">å†·è—+14å¤©</option>
                    <option value="21">å¸¸æº«+21å¤©</option>
                    <option value="30">ç‰¹æ®Š+30å¤©</option>
                    <option value="45">é™½å…‰+45å¤©</option>
                </select>
            </div>
            <button id="expiryBtn" class="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 rounded-xl w-full shadow-lg shadow-emerald-100 transition-all active:scale-95">ç”¢å‡ºæ•ˆæœŸæ—¥æœŸ</button>
            <div id="expiryResult" class="mt-4 text-center font-black text-emerald-800 text-lg min-h-[1.75rem]"></div>
        </section>

        <!-- æ‰¹è™Ÿè½‰æ›å€å¡Š -->
        <section class="section-card">
            <h2 class="text-lg font-bold text-slate-700 mb-4">æ‰¹è™ŸæŸ¥è©¢ (Hex to Dec)</h2>
            <div class="flex gap-3 mb-2">
                <input id="hexInput" type="text" placeholder="è¼¸å…¥16é€²åˆ¶æ‰¹è™Ÿ (å¦‚: FF)" class="border rounded-xl px-4 py-2 flex-1 focus:ring-2 focus:ring-orange-500 outline-none uppercase font-mono">
                <button id="toDecBtn" class="bg-orange-600 hover:bg-orange-700 text-white px-6 rounded-xl font-bold transition-all active:scale-95">è½‰æ›</button>
            </div>
            <div id="batchResult" class="mt-4 text-center font-bold text-orange-800 text-lg min-h-[1.75rem]"></div>
        </section>
    </main>

    <!-- Flatpickr JS & ä¸­æ–‡èªç³» -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/zh-tw.js"></script>

    <script>
        // å•Ÿç”¨ Flatpickr ä¸­æ–‡æ—¥æ›†
        flatpickr("#mfgDate", {
            locale: "zh_tw",
            dateFormat: "Yå¹´mæœˆdæ—¥",
            defaultDate: "today"
        });

        // æ•¸æ“šçŸ©é™£ï¼š[å°, ä¸­, å¤§]
        const DATA = {
            item1: [1, 3, 6],   // é›™å±¤-çœŸæ„›æŒ‘æ—¥å­
            item2: [2, 3, 6],   // é›™å±¤-è‡ªè£½ç›’
            item3: [4, 6, 16],  // è¯éº—ä¼¯çˆµ
            item4: [3, 6, 12],  // å±±èŒ¶èŠ±é–‹æ™‚&HANA
            item5: [3, 8, 12],  // å’Œå…‰è“å®¤&ç¹”èŠ±
            item6: [3, 8, 10],  // å¾®ç¬‘ä¿±æ¨‚éƒ¨
            item7: [8, 10, 18], // 6å…¥æ˜Ÿç©ºå¤©åœ°è“‹ç›’
            item8: [0, 4, 6]    // èŠ±æ‰‹é 
        };

        // ç®±æ•¸è¨ˆç®—é‚è¼¯
        document.getElementById('calculateBtn').addEventListener('click', () => {
            const v = id => parseInt(document.getElementById(id).value) || 0;
            
            let counts = {
                item1: v('item1'), item2: v('item2'), item3: v('item3'),
                item4: v('item4'), item5: v('item5'), item6: v('item6'),
                item7: v('item7'), item8: v('item8')
            };

            let res = { large: 0, medium: 0, small: 0 };
            const totalItems = Object.values(counts).reduce((a, b) => a + b, 0);

            // 1. å„ªå…ˆå¡«æ»¿å¤§ç®± (æœ€å„ªå…ˆ)
            for (let key in DATA) {
                let largeCap = DATA[key][2]; // å¤§ç®±å®¹é‡ç´¢å¼• 2
                if (largeCap > 0 && counts[key] >= largeCap) {
                    let num = Math.floor(counts[key] / largeCap);
                    res.large += num;
                    counts[key] %= largeCap;
                }
            }

            // 2. è™•ç†å‰©ä¸‹çš„æ•£æ•¸ä½µç®±
            let hasRemainder = Object.values(counts).some(c => c > 0);
            if (hasRemainder) {
                const checkFit = (idx) => {
                    let ratioSum = 0;
                    for (let key in DATA) {
                        let capacity = DATA[key][idx];
                        if (capacity === 0) {
                            if (counts[key] > 0) return false;
                            else continue;
                        }
                        ratioSum += counts[key] / capacity;
                    }
                    return ratioSum <= 1.0001; 
                };

                // æ•£æ•¸ä½µç®±ä¾åºå˜—è©¦æœ€å°å¯å®¹ç´çš„ç®±å‹ï¼šå° -> ä¸­ -> å¤§
                if (checkFit(0)) {
                    res.small++;
                } else if (checkFit(1)) {
                    res.medium++;
                } else {
                    res.large++;
                }
            }

            document.getElementById('resultText').innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="text-center p-4 bg-white rounded-lg border border-indigo-200">
                        <p class="text-xs text-indigo-500 font-bold mb-1">å¤§ç´™ç®±</p>
                        <p class="font-black text-3xl text-indigo-900">${res.large}</p>
                    </div>
                    <div class="text-center p-4 bg-white rounded-lg border border-indigo-200">
                        <p class="text-xs text-indigo-500 font-bold mb-1">ä¸­ç´™ç®±</p>
                        <p class="font-black text-3xl text-indigo-900">${res.medium}</p>
                    </div>
                    <div class="text-center p-4 bg-white rounded-lg border border-indigo-200">
                        <p class="text-xs text-indigo-500 font-bold mb-1">å°ç´™ç®±</p>
                        <p class="font-black text-3xl text-indigo-900">${res.small}</p>
                    </div>
                </div>
                <p class="mt-4 text-xs text-indigo-400 text-right">ç¸½è¨ˆç›’æ•¸ï¼š${totalItems}</p>
            `;
        });

        // é‡ç½®åŠŸèƒ½
        document.getElementById('resetBtn').addEventListener('click', () => {
            for(let i=1; i<=8; i++) {
                const input = document.getElementById('item'+i);
                if(input) input.value = 0;
            }
            document.getElementById('resultText').textContent = 'è«‹è¼¸å…¥æ•¸é‡ä¸¦é»æ“Šã€Œè¨ˆç®—ç®±æ•¸ã€ã€‚';
            document.getElementById('expiryResult').textContent = '';
            document.getElementById('batchResult').textContent = '';
            document.getElementById('hexInput').value = '';
        });

        // æ•ˆæœŸè¨ˆç®—
        document.getElementById('expiryBtn').addEventListener('click', () => {
            const mfg = document.getElementById('mfgDate').value;
            const days = parseInt(document.getElementById('storageType').value);
            if(!mfg){ document.getElementById('expiryResult').textContent = 'è«‹é¸æ“‡æ—¥æœŸ'; return; }
            
            const dateStr = mfg.replace(/[å¹´æœˆ]/g, "-").replace("æ—¥","");
            const mfgDate = new Date(dateStr); 
            
            if(isNaN(mfgDate)){ document.getElementById('expiryResult').textContent = 'æ—¥æœŸæ ¼å¼éŒ¯èª¤'; return; }
            
            const expiry = new Date(mfgDate.getTime() + days * 24 * 60 * 60 * 1000);
            document.getElementById('expiryResult').textContent = 
                `åˆ°æœŸæ—¥ï¼š${expiry.getFullYear()}å¹´${expiry.getMonth()+1}æœˆ${expiry.getDate()}æ—¥`;
        });

        // æ‰¹è™Ÿè½‰æ›
        document.getElementById('toDecBtn').addEventListener('click', () => {
            const hex = document.getElementById('hexInput').value.trim();
            if(!/^[0-9a-fA-F]+$/.test(hex)){ 
                document.getElementById('batchResult').textContent = 'è«‹è¼¸å…¥æœ‰æ•ˆçš„16é€²åˆ¶å­—ä¸²'; 
                return; 
            }
            const dec = parseInt(hex, 16);
            document.getElementById('batchResult').textContent = `${hex.toUpperCase()} â” ${dec}`;
        });
    </script>
</body>
</html>
